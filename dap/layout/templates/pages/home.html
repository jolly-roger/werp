{% extends "base.html" %}
{% block content %}
	<div class="row collapse">
		<div class="small-3 large-2 columns">
			<span class="prefix">http://</span>
		</div>
		<div class="small-6 large-8 columns">
			<input id="domain_value" type="text" name="domain" placeholder="Enter Domain or URL...">
		</div>
		<div class="small-3 large-2 columns">
			<button id="check_proxies_btn" type="button" class="button prefix" >Check</button>
		</div>
	</div>
	<div class="row collapse">
		<div id="container_proxies" class="small-12 large-12 columns">
		</div>
	</div>
	<script type="text/javascript">
		var domain_value = ''
		var proxy_status_prefix = 'proxy_status_'
		container_proxies = $('#container_proxies');
		
		function get_accessibility(){
			$.getJSON( "/get_10_checked?domain=" + domain_value, function(data){
				for (var i in data) {
					$('#' + proxy_status_prefix + data[i]['id']).html('accessible');
				}
			});
			$.getJSON( "/is_check_finished?domain=" + domain_value, function(data){
				if (!data){
					setTimeout(get_accessibility, 1000);
				}
			});
		}
		
		$('#check_proxies_btn').click(function(){
			domain_value = $('#domain_value').val()
			$.getJSON('/check_10?domain=' + domain_value, function(data){
				html_proxies = '<div class="row">';
				for (var i in data) {
					html_proxies += '<div class="small-6 large-6 columns">' + data[i]['ip'] + '</div>' +
						'<div class="small-3 large-3 columns">' + data[i]['port'] + '</div>' +
						'<div class="small-3 large-3 columns" id="' + proxy_status_prefix + data[i]['id'] + '"></div>';
				}
				html_proxies += '</div>';
				container_proxies.html(html_proxies);
			});
			
			setTimeout(get_accessibility, 1000);
		});
	</script>
{% endblock %}
