{% extends "base.html" %}
{% block content %}
	<div class="row collapse">
		<div class="small-3 large-2 columns">
			<span class="prefix">http://</span>
		</div>
		<div class="small-6 large-8 columns">
			<input id="domain_value" type="text" name="domain" placeholder="Enter Domain or URL...">
		</div>
		<div class="small-3 large-2 columns">
			<button id="check_proxies_btn" type="button" class="button prefix" >Check</button>
		</div>
	</div>
	<div class="row">
		<div class="small-offset-3 large-offset-3 small-6 large-6 columns">
			<table id="container_proxies" style="width: 100%;"></table>
		</div>
	</div>
	<script type="text/javascript">
		var domain_value = ''
		var proxy_status_prefix = 'proxy_status_'
		container_proxies = $('#container_proxies');
		
		function get_accessibility(){
			$.getJSON( "/get_10_checked?domain=" + domain_value, function(data){
				for (var i in data) {
					$('#' + proxy_status_prefix + data[i]['id']).html('<span class="round success label">accessible</span>');
				}
			});
			$.getJSON( "/is_check_finished?domain=" + domain_value, function(data){
				if(!data){
					setTimeout(get_accessibility, 1000);
				}else{
					$('.checking_img').each(function(){
						$(this).parent().html('<span class="round alert label">unaccessible</span>');
					});
				}
			});
		}
		
		$('#check_proxies_btn').click(function(){
			domain_value = $('#domain_value').val()
			$.getJSON('/check_10?domain=' + domain_value, function(data){
				html_proxies = '';
				for (var i in data) {
					html_proxies += '<tr><td>' + data[i]['ip'] + '</td>' +
						'<td>' + data[i]['port'] + '</td>' +
						'<td id="' + proxy_status_prefix + data[i]['id'] + '">' +
							'<img class="checking_img" src="/images/checking.gif" alt="Checking..." />' +
						'</td></tr>';
				}
				container_proxies.html(html_proxies);
			});
			
			setTimeout(get_accessibility, 1000);
		});
	</script>
{% endblock %}
